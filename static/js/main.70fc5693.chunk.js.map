{"version":3,"sources":["B-Open.svg","../../src/utils.js","../../src/drawing-pane.js","../../src/events.js","../../src/control.js","../../src/index.js","index.js"],"names":["module","exports","cls","name","additionalClasses","clsName","split","map","s","index","toUpperCase","substring","join","toCamelCase","styles","setPosition","el","point","offset","nextPoint","add","_leaflet_pos","Browser","any3d","DomUtil","setTransform","style","left","x","top","y","CLICK_EVT","mobile","isTrustedEvent","event","isTrusted","window","Cypress","PANE_NAME","createPane","options","newNode","referenceNode","standardPanesContainer","getContainer","querySelector","overlayPanesContainer","active","fadeOnActivation","create","drawingPaneContainer","parentNode","insertBefore","nextSibling","pane","addEventListener","stopPropagation","fire","removeEndClickArea","control","marker","getMap","getPane","remove","doNothingHandler","originalEvent","preventDefault","onAddPoint","this","mapMoving","clientX","clientY","undefined","touch","changedTouches","rectDrawing","rectDrawEnd","bbox","getBoundingClientRect","markers","length","_ref","setAttribute","once","hoverClosePoint","bind","outClosePoint","Point","width","height","addEndClickArea","icon","DivIcon","className","iconSize","Marker","containerPointToLatLng","draggable","_onMarkerDrag","onMarkerDrag","on","target","getElement","classList","requestAnimationFrame","_this","onPolygonReady","newEdge","addTo","i","off","_loop","onAddMarker","rest","edge","push","splice","enoughPoints","phase","forEach","getIcon","setIcon","closeLine","removeLayer","Polyline","getLatLng","weight","color","addLayer","onRemoveMarker","_ref4","removeFrom","_this2","_loop2","onUpdatePolygon","polygon","Polygon","dashArray","ev","DomEvent","_this3","onPolygonDblClick","onUpdateGhostPoints","_this4","clearGhostMarkers","ghostMarkers","currentMarker","nextMarker","currentLatLng","nextLatLng","latLngToContainerPoint","lat","lng","newGhostMarker","onGhostMarkerDragStart","onGhostMarkerDrag","onGhostMarkerDragEnd","onPolygonCreationEnd","dragging","enable","setPhase","onActivate","_dragStatus","_enabled","blur","disable","onButtonDeactivate","defaultPrevented","deactivate","onButtonActivate","activate","latlng","firstPoint","_this5","lastPoint","ghostPolygon","opacity","fillOpacity","_this6","newPoint","fakeEvent","onMouseMove","which","buttons","rectDrawStart","props","draggingRect","LayerGroup","pointA","pointB","layers","getLayers","setLatLngs","mouseEventToLatLng","onDraggingRectEnd","vertex1","vertex2","vertex3","vertex4","_map","DrawAreaSelection","Control","extend","initialize","Util","setOptions","_mapMoveStart","_mapMoveEnd","_handleMouseMove","onAdd","_container","activateButton","addUserHelpPanel","onRemove","removeEventListener","panel","help","textContent","appendChild","forceClear","clearMarkers","clearPolygon","container","touchMarker","firstMarker","drawAreaSelection","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","require","iconUrl","shadowUrl","center","Map","tap","setView","tileLayer","attribution","MAP_LOADED","popup","document","createElement","innerHTML","bindPopup","areaSelection","preview","getElementById","JSON","stringify","toGeoJSON","scrollTop","scrollHeight","geoJSON","console","log","position","addControl"],"mappings":"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","file":"static/js/main.70fc5693.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/B-Open.a8695c4b.svg\";","import { Browser, DomUtil } from 'leaflet';\nimport styles from './styles.module.css';\n\nexport function toCamelCase(name) {\n  return name\n    .split('-')\n    .map((s, index) => (index === 0 ? s : `${s[0].toUpperCase()}${s.substring(1)}`))\n    .join('');\n}\n\nexport function cls(name, additionalClasses = '') {\n  const clsName = toCamelCase(name);\n  if (styles[clsName]) {\n    return additionalClasses\n      ? `${styles[clsName]} ${name} ${additionalClasses}`\n      : `${styles[clsName]} ${name}`;\n  }\n  // Fallback to just return name and maybe additional classes\n  return additionalClasses ? `${name} ${additionalClasses}` : name;\n}\n\nexport function insertAfter(newNode, referenceNode) {\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n/**\n * Like original DomUtil.setPosition, but takes an optional offset\n * @param {DOMElement} el\n * @param {Point} point\n */\nexport function setPosition(el, point, offset = null) {\n  const nextPoint = offset ? point.add(offset) : point;\n  el._leaflet_pos = nextPoint;\n\n  if (Browser.any3d) {\n    DomUtil.setTransform(el, nextPoint);\n  } else {\n    el.style.left = nextPoint.x + 'px';\n    el.style.top = nextPoint.y + 'px';\n  }\n}\n\nexport const CLICK_EVT = Browser.mobile ? 'touchend' : 'click';\n\n// This still needed due to bad Leaflet bug on Safari. See https://github.com/Leaflet/Leaflet/issues/7255\nexport function isTrustedEvent(event) {\n  return event.isTrusted || window.Cypress;\n}\n","import { DomUtil, Point } from 'leaflet';\nimport { cls, insertAfter, setPosition, CLICK_EVT, isTrustedEvent } from './utils';\n\nexport const PANE_NAME = 'area-draw-selection';\n\nfunction drawingPaneContainer(options) {\n  const { active, fadeOnActivation } = options;\n  const drawPane = DomUtil.create(\n    'div',\n    cls(\n      'leaflet-map-overlay-pane',\n      `leaflet-pane${active ? '' : ' inactive'}${fadeOnActivation ? ' fading-enabled' : ''}`\n    )\n  );\n  return drawPane;\n}\n\nexport function createPane(map, options) {\n  const standardPanesContainer = map.getContainer().querySelector('.leaflet-map-pane');\n  const overlayPanesContainer = drawingPaneContainer(options);\n  insertAfter(overlayPanesContainer, standardPanesContainer);\n  const pane = map.createPane(PANE_NAME, overlayPanesContainer);\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:point-add', event);\n  };\n  pane.addEventListener(CLICK_EVT, handler);\n  return pane;\n}\n\nexport function addEndClickArea(control, [x, y]) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = DomUtil.create('div', cls('end-selection-area'), pane);\n  const bbox = marker.getBoundingClientRect();\n  marker.setAttribute('role', 'button');\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:creation-end');\n  };\n  marker.addEventListener(CLICK_EVT, handler, {\n    once: true,\n  });\n  marker.addEventListener('mouseenter', control.hoverClosePoint.bind(control));\n  marker.addEventListener('mouseleave', control.outClosePoint.bind(control));\n  setPosition(marker, new Point(x, y), new Point(-bbox.width / 2, -bbox.height / 2));\n}\n\nexport function removeEndClickArea(control) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = pane.querySelector('.end-selection-area');\n  if (marker) {\n    marker.remove();\n  }\n}\n","import { DivIcon, Marker, Point, Polygon, Polyline, DomEvent, LayerGroup } from 'leaflet';\nimport { cls, isTrustedEvent, CLICK_EVT } from './utils';\nimport { addEndClickArea, removeEndClickArea } from './drawing-pane';\n\nfunction doNothingHandler(event) {\n  event.originalEvent.preventDefault();\n  event.originalEvent.stopPropagation();\n}\n\n/**\n * Event handler reacting to an add point action\n * @param {MouseEvent|TouchEvent} event\n */\nexport function onAddPoint(event) {\n  // Default behavior while dragging\n  if (this.mapMoving) {\n    return;\n  }\n  const map = this.getMap();\n  let { clientX, clientY } = event;\n  // Touch device\n  if (clientX === undefined && clientY === undefined) {\n    const touch = event.changedTouches[0];\n    clientX = touch.clientX;\n    clientY = touch.clientY;\n  }\n  // We were drawing a rect, so we don't perform the canonical action and we stop here\n  if (this.rectDrawing && this.rectDrawEnd !== null) {\n    map.fire('as:dragging-rect-end');\n    return;\n  }\n\n  const { index = null } = event;\n  const container = map.getContainer();\n  const bbox = container.getBoundingClientRect();\n  const x = clientX - bbox.left;\n  const y = clientY - bbox.top;\n  if (this.markers.length === 0) {\n    // this is the first point: let's add a sensible click area on the pane too\n    addEndClickArea(this, [x, y]);\n  }\n  const point = new Point(x, y);\n  const icon = new DivIcon({\n    className: cls('area-select-marker'),\n    iconSize: [16, 16],\n  });\n  const marker = new Marker(map.containerPointToLatLng(point), {\n    icon,\n    draggable: true,\n  });\n  const _onMarkerDrag = onMarkerDrag.bind(this);\n  marker.on('drag', _onMarkerDrag(index === null ? this.markers.length : index));\n  marker.on('dragstart', (event) => {\n    event.target.getElement().classList.add('active');\n  });\n  marker.on('dragend', (event) => {\n    event.target.getElement().classList.remove('active');\n    requestAnimationFrame(() => {\n      this.onPolygonReady();\n    });\n  });\n  const newEdge = {\n    marker,\n    index,\n  };\n  marker.on(\n    'dblclick',\n    ((length) => (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...newEdge,\n        index: index === null ? length : index,\n      });\n    })(this.markers.length)\n  );\n  marker.on(CLICK_EVT, doNothingHandler);\n  marker.addTo(map);\n  map.fire('as:marker-add', newEdge);\n  // If this point as not been added at the end, we need to update even handlers HOC params to update index\n  if (index !== null) {\n    for (let i = index + 1; i < this.markers.length; i++) {\n      this.markers[i].marker.off('drag');\n      this.markers[i].marker.on('drag', _onMarkerDrag(i));\n      this.markers[i].marker.off(CLICK_EVT);\n      this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n      this.markers[i].marker.off('dblclick');\n      this.markers[i].marker.on('dblclick', (event) => {\n        map.fire('as:marker-remove', {\n          ...this.markers[i],\n          index: i,\n        });\n      });\n    }\n  }\n}\n\nexport function onAddMarker({ index = null, ...rest }) {\n  const map = this.getMap();\n  const edge = {\n    marker: rest.marker,\n  };\n  const { markers } = this;\n  if (index === null) {\n    markers.push(edge);\n  } else {\n    markers.splice(index, 0, edge);\n  }\n  const enoughPoints = markers.length >= 3;\n  if (this.phase === 'draw') {\n    if (!enoughPoints) {\n      markers.forEach(({ marker }) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', 'invalid');\n        marker.setIcon(icon);\n      });\n    } else if (markers.length === 3) {\n      // Restore colors\n      markers.forEach(({ marker }, index) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', index === 0 ? 'start-marker' : null);\n        marker.setIcon(icon);\n      });\n    }\n  }\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n    this.onPolygonReady();\n  }\n\n  if (this.phase === 'draw') {\n    // close line\n    if (this.closeLine) {\n      map.removeLayer(this.closeLine);\n    }\n    if (enoughPoints) {\n      this.closeLine = new Polyline(\n        [markers[0].marker.getLatLng(), markers[markers.length - 1].marker.getLatLng()],\n        {\n          weight: 3,\n          color: '#c0c0c0',\n          className: 'areaCloseLine',\n        }\n      );\n      map.addLayer(this.closeLine);\n    }\n  }\n}\n\nexport function onRemoveMarker({ index = 0 }) {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length > 3;\n  if (!enoughPoints) {\n    return;\n  }\n  const removed = this.markers.splice(index || 0, 1);\n  removed[0].marker.removeFrom(map);\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n  }\n  for (let i = index; i < this.markers.length; i++) {\n    this.markers[i].marker.off('drag');\n    this.markers[i].marker.on('drag', onMarkerDrag.bind(this)(i));\n    this.markers[i].marker.off(CLICK_EVT);\n    this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n    this.markers[i].marker.off('dblclick');\n    this.markers[i].marker.on('dblclick', (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...this.markers[i],\n        index: i,\n      });\n    });\n  }\n  this.onPolygonReady();\n}\n\n/**\n * Refresh the polygon on the map\n */\nexport function onUpdatePolygon() {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length >= 3;\n  const polygon = new Polygon(\n    markers.map(({ marker }) => {\n      return marker.getLatLng();\n      // return map.containerPointToLatLng(point);\n    }),\n    {\n      color: enoughPoints ? 'rgb(45, 123, 200)' : 'rgba(220, 53, 69, 0.7)',\n      weight: 2,\n      ...(!enoughPoints && { dashArray: '5, 10' }),\n      className: 'drawing-area-poligon',\n    }\n  );\n  polygon.on(CLICK_EVT, (ev) => {\n    DomEvent.stopPropagation(ev);\n  });\n\n  polygon.on('dblclick', (ev) => {\n    // Preventing zoom-on-doubleclick is not working. I'll leave hacky workarounds to user's implementation\n    // See https://stackoverflow.com/questions/15406537/disable-map-zoom-on-circlemarker-double-click-in-leaflet\n    DomEvent.stopPropagation(ev);\n    this.onPolygonDblClick(ev);\n    return false;\n  });\n  if (this.polygon) {\n    map.removeLayer(this.polygon);\n  }\n  this.polygon = polygon;\n  map.addLayer(this.polygon);\n}\n\nexport function onUpdateGhostPoints() {\n  const map = this.getMap();\n  requestAnimationFrame(() => {\n    this.clearGhostMarkers();\n    const { markers, ghostMarkers } = this;\n    markers.forEach((currentMarker, index) => {\n      const nextMarker = markers[index + 1] ? markers[index + 1] : markers[0];\n      const currentLatLng = currentMarker.marker.getLatLng();\n      const nextLatLng = nextMarker.marker.getLatLng();\n      const point = map.latLngToContainerPoint([\n        (currentLatLng.lat + nextLatLng.lat) / 2,\n        (currentLatLng.lng + nextLatLng.lng) / 2,\n      ]);\n\n      const icon = new DivIcon({\n        className: cls('area-select-ghost-marker'),\n        iconSize: [16, 16],\n      });\n      const marker = new Marker(map.containerPointToLatLng(point), {\n        icon,\n        draggable: true,\n      });\n      const newGhostMarker = {\n        marker,\n      };\n      marker.on(CLICK_EVT, doNothingHandler);\n      marker.on('dblclick', doNothingHandler);\n      marker.on('dragstart', onGhostMarkerDragStart.bind(this)());\n      marker.on('drag', onGhostMarkerDrag.bind(this)(ghostMarkers.length));\n      marker.on('dragend', onGhostMarkerDragEnd.bind(this)(ghostMarkers.length));\n      ghostMarkers.push(newGhostMarker);\n      marker.addTo(map);\n    });\n  });\n}\n\nexport function onPolygonCreationEnd() {\n  const map = this.getMap();\n  // We'll forcly enable the drag on the map (which will be just of the draw pane)\n  map.dragging.enable();\n  map.removeLayer(this.closeLine);\n  this.closeLine = null;\n  // Remove style for the final marker icon\n  this.markers[0].marker.getElement().classList.remove('start-marker');\n  this.setPhase('adjust');\n  map.fire('as:update-ghost-points');\n  this.onPolygonReady();\n  removeEndClickArea(this);\n}\n\n/**\n * Plugin activation (button pressed)\n */\nexport function onActivate(event) {\n  // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n  if (!isTrustedEvent(event)) {\n    return;\n  }\n  const map = this.getMap();\n  // storing if the dragging is enabled in the map\n  this._dragStatus = map.dragging._enabled;\n\n  // Let leave to custom callback any call to preventDefault, which will block normal button behaviors\n  // event.preventDefault();\n  event.stopPropagation();\n  event.target.blur();\n  // if current state is active, we need to deactivate\n  const activeState = this.options.active || this.phase === 'adjust';\n  if (activeState) {\n    // Disable dragging if it was enabled before the activation\n    if (!this._dragStatus) {\n      map.dragging.disable();\n    }\n\n    // Calling user's specific event handler\n    this.options.onButtonDeactivate(this.polygon, this, event);\n    if (!event.defaultPrevented) {\n      this.deactivate();\n    }\n  } else {\n    // Calling user's specific event handler\n    this.options.onButtonActivate(this, event);\n    if (!event.defaultPrevented) {\n      this.activate();\n    }\n  }\n}\n\nexport function onMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    requestAnimationFrame(() => {\n      map.fire('as:update-polygon');\n      map.fire('as:update-ghost-points');\n    });\n  };\n}\n\nexport function onGhostMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { latlng } = event;\n    requestAnimationFrame(() => {\n      // Given a ghost point, markers to be used as edges are the one at +0 and +1\n      const firstPoint = this.markers[index];\n      const lastPoint = this.markers[index + 1] ? this.markers[index + 1] : this.markers[0];\n      if (this.ghostPolygon) {\n        map.removeLayer(this.ghostPolygon);\n      }\n      this.ghostPolygon = new Polygon(\n        [firstPoint.marker.getLatLng(), latlng, lastPoint.marker.getLatLng()],\n        {\n          color: 'rgb(45, 123, 200)',\n          weight: 2,\n          opacity: 0.5,\n          fillOpacity: 0.1,\n          dashArray: '5, 10',\n        }\n      );\n      map.addLayer(this.ghostPolygon);\n      map.fire('as:update-polygon');\n    });\n  };\n}\n\nexport function onGhostMarkerDragStart() {\n  return (event) => {\n    event.target.getElement().classList.add('active');\n  };\n}\n\nexport function onGhostMarkerDragEnd(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { target } = event;\n    target.getElement().classList.remove('active');\n    target.removeFrom(map);\n    if (this.ghostPolygon) {\n      map.removeLayer(this.ghostPolygon);\n    }\n    const newPoint = map.latLngToContainerPoint(target.getLatLng());\n    const container = map.getContainer();\n    const bbox = container.getBoundingClientRect();\n    const fakeEvent = {\n      clientX: newPoint.x + bbox.left,\n      clientY: newPoint.y + bbox.top,\n      index: index + 1,\n    };\n    map.fire('as:point-add', fakeEvent);\n  };\n}\n\nexport function onMouseMove(event) {\n  if (!this.mapMoving && this.markers.length === 0 && event.which !== 0 && event.buttons === 1) {\n    const map = this.getMap();\n    if (!this.rectDrawing) {\n      this.rectDrawStart = [event.clientX, event.clientY];\n      const props = {\n        weight: 2,\n        color: '#8B4513',\n        className: 'rect-progress-line',\n        opacity: 0.6,\n      };\n      this.draggingRect = new LayerGroup()\n        .addLayer(new Polyline([], props))\n        .addLayer(new Polyline([], props))\n        .addTo(map);\n      this.rectDrawing = true;\n      return;\n    }\n    this.rectDrawEnd = [event.clientX, event.clientY];\n    const pointA = [this.rectDrawStart[0], event.clientY];\n    const pointB = [event.clientX, this.rectDrawStart[1]];\n\n    const layers = this.draggingRect.getLayers();\n    layers[0].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointA[0], clientY: pointA[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n    layers[1].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointB[0], clientY: pointB[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n  }\n}\n\nexport function onDraggingRectEnd() {\n  this.rectDrawing = false;\n  const vertex1 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] };\n  const vertex2 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawStart[1] };\n  const vertex3 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] };\n  const vertex4 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawEnd[1] };\n  onAddPoint.bind(this)(vertex1);\n  onAddPoint.bind(this)(vertex2);\n  onAddPoint.bind(this)(vertex3);\n  onAddPoint.bind(this)(vertex4);\n  this._map.fire('as:creation-end');\n  this.rectDrawStart = null;\n  this.rectDrawEnd = null;\n  this.draggingRect.removeFrom(this._map);\n}\n","import { DomUtil, Control, Util, Point, Browser } from 'leaflet';\nimport { createPane, removeEndClickArea, PANE_NAME } from './drawing-pane';\nimport { cls, setPosition } from './utils';\nimport {\n  onActivate,\n  onAddMarker,\n  onAddPoint,\n  onDraggingRectEnd,\n  onMouseMove,\n  onPolygonCreationEnd,\n  onRemoveMarker,\n  onUpdateGhostPoints,\n  onUpdatePolygon,\n} from './events';\n\n// import buttonImage from './images/area-icon.png';\n\nexport const DrawAreaSelection = Control.extend({\n  options: {\n    // activate automatically area selection on plugin load\n    active: false,\n    // partially fade the map when draw phase is activated\n    fadeOnActivation: true,\n    /* ******* callbacks ******* */\n    // callback called when draw phase is complete and at every polygon adjustement\n    onPolygonReady: (polygon, control) => {},\n    // callback called when draw phase is complete and double-click is performed on the final polygon\n    onPolygonDblClick: (polygon, control, event) => {},\n    // callback called when user press the activation button\n    onButtonActivate: (control, event) => {},\n    // callback called when user press the button to deactivate (not called when the plugin deactivate itself automatically)\n    onButtonDeactivate: (polygon, control, event) => {},\n  },\n\n  initialize: function (options = {}) {\n    Util.setOptions(this, options);\n    this._map = null;\n    // lifecycle phases: one of inactive, draw, adjust\n    this.phase = options.active ? 'draw' : 'inactive';\n    this.mapMoving = false;\n    // map if in phase of drawing a rectangle\n    this.rectDrawing = false;\n    // where user started to draw a rect\n    this.rectDrawStart = null;\n    this.rectDrawEnd = null;\n    // the dragging rect, composed by two lines\n    this.draggingRect = null;\n    // edge markers used for drawing, next dragging the polygon\n    this.markers = [];\n    // fake markers used for adding rings to the polygon\n    this.ghostMarkers = [];\n    // The actual polygon draw\n    this.polygon = null;\n    // on drawing phase: a line from the last drawn point to the first ones\n    this.closeLine = null;\n\n    this._mapMoveStart = this._mapMoveStart.bind(this);\n    this._mapMoveEnd = this._mapMoveEnd.bind(this);\n    this._handleMouseMove = this._handleMouseMove.bind(this);\n  },\n\n  onAdd: function (map) {\n    this._container = DomUtil.create('div', cls('leaflet-area-selector-control'));\n    this.activateButton = DomUtil.create('button', '', this._container);\n    // this.activateButton.style.backgroundImage = `url('${buttonImage}')`;\n    this.activateButton.setAttribute('aria-label', 'Draw shape');\n    this.activateButton.setAttribute('aria-describedby', 'draw-panel-help');\n    this.activateButton.addEventListener('click', onActivate.bind(this));\n    this.activateButton.addEventListener('dblclick', (event) => {\n      event.stopPropagation();\n    });\n    this.options.active\n      ? this.activateButton.classList.add('active')\n      : this.activateButton.classList.remove('active');\n    this._map = map;\n    const pane = createPane(map, this.options);\n    this.addUserHelpPanel(pane);\n    map.getContainer().addEventListener('mousemove', this._handleMouseMove);\n    map.on('movestart', this._mapMoveStart);\n    map.on('moveend', this._mapMoveEnd);\n    map.on('as:point-add', onAddPoint.bind(this));\n    map.on('as:marker-add', onAddMarker.bind(this));\n    map.on('as:marker-remove', onRemoveMarker.bind(this));\n    map.on('as:creation-end', onPolygonCreationEnd.bind(this));\n    map.on('as:update-polygon', onUpdatePolygon.bind(this));\n    map.on('as:update-ghost-points', onUpdateGhostPoints.bind(this));\n    map.on('as:dragging-rect-end', onDraggingRectEnd.bind(this));\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.getContainer().removeEventListener('mousemove', this._handleMouseMove);\n    map.off('movestart', this._mapMoveStart);\n    map.off('moveend', this._mapMoveEnd);\n    map.off('as:point-add');\n    map.off('as:marker-add');\n    map.off('as:marker-remove');\n    map.off('as:creation-end');\n    map.off('as:update-polygon');\n    map.off('as:update-ghost-points');\n    map.off('as:dragging-rect-end');\n  },\n\n  getMap: function () {\n    return this._map;\n  },\n\n  onPolygonReady: function () {\n    this.options.onPolygonReady(this.polygon, this);\n  },\n\n  onPolygonDblClick: function (ev) {\n    this.options.onPolygonDblClick(this.polygon, this, ev);\n  },\n\n  addUserHelpPanel(pane) {\n    const panel = DomUtil.create('div', cls('draw-pane-help'));\n    panel.setAttribute('id', 'draw-panel-help');\n    panel.setAttribute('role', 'tooltip');\n    const help = `Define a polygon by clicking of the map to define vertexes${\n      Browser.mobile ? `.` : ` or click-and-drag to obtain a rectangular shape.`\n    }`;\n    panel.textContent = help;\n\n    pane.appendChild(panel);\n  },\n\n  setPhase(phase, forceClear = false) {\n    this.phase = phase;\n    this.options.active = phase === 'draw';\n    // If we didn't finished to fill a polygon, let's clear all\n    if (forceClear || this.phase === 'draw') {\n      this.clearGhostMarkers();\n      this.clearMarkers();\n      this.clearPolygon();\n    }\n    const pane = this._map.getPane(PANE_NAME);\n    const container = pane.parentNode;\n    this.options.active\n      ? container.classList.remove('inactive')\n      : container.classList.add('inactive');\n  },\n\n  _mapMoveStart: function () {\n    if (!this.options.active) {\n      return;\n    }\n    this.mapMoving = true;\n  },\n\n  _mapMoveEnd: function () {\n    if (!this.options.active) {\n      return;\n    }\n    const map = this._map;\n    requestAnimationFrame(() => {\n      this.mapMoving = false;\n    });\n    // Re-position end of selection HTML element\n    const pane = map.getPane(PANE_NAME);\n    const touchMarker = pane.querySelector('.end-selection-area');\n    if (touchMarker) {\n      const firstMarker = this.markers[0].marker;\n      const bbox = touchMarker.getBoundingClientRect();\n      const point = map.latLngToContainerPoint(firstMarker.getLatLng());\n      setPosition(touchMarker, point, new Point(-bbox.width / 2, -bbox.height / 2));\n    }\n  },\n\n  hoverClosePoint: function (event) {\n    if (this.markers.length > 2 && this.closeLine) {\n      this.closeLine.removeFrom(this._map);\n    }\n  },\n\n  outClosePoint: function (event) {\n    if (this.closeLine) {\n      this.closeLine.addTo(this._map);\n    }\n  },\n\n  clearMarkers: function () {\n    this.markers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.markers = [];\n  },\n\n  clearGhostMarkers: function () {\n    this.ghostMarkers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.ghostMarkers = [];\n  },\n\n  clearPolygon: function () {\n    this.polygon && this.polygon.removeFrom(this._map);\n    this.polygon = null;\n    this.closeLine && this.closeLine.removeFrom(this._map);\n    this.closeLine = null;\n  },\n\n  deactivate: function () {\n    removeEndClickArea(this);\n    this.activateButton.classList.remove('active');\n    this._map.getContainer().classList.remove('drawing-area');\n    this.setPhase('inactive', true);\n  },\n\n  activate: function () {\n    // When activating the plugin we'll disable dragging temporarely (in case we are drawing a rect)\n    this._map.dragging.disable();\n    this.activateButton.classList.add('active');\n    this._map.getContainer().classList.add('drawing-area');\n    this.setPhase('draw', true);\n  },\n\n  _handleMouseMove: function (event) {\n    if (!this.options.active) {\n      return;\n    }\n    onMouseMove.bind(this)(event);\n  },\n});\n\nexport const drawAreaSelection = function (options = {}) {\n  return new DrawAreaSelection(options);\n};\n","import { Util, Control } from 'leaflet';\nimport { DrawAreaSelection, drawAreaSelection } from './control';\n\nUtil.extend(Control, {\n  DrawAreaSelection,\n  drawAreaSelection,\n});\n\nexport { DrawAreaSelection, drawAreaSelection };\n","/* eslint-disable no-console */\nimport { Map, Icon, tileLayer, marker, geoJSON, Browser } from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport '@bopen/leaflet-area-selection/dist/index.css';\nimport { DrawAreaSelection } from '@bopen/leaflet-area-selection';\n\nimport './index.css';\n\nimport icon from './B-Open.svg';\n\n// See https://github.com/Leaflet/Leaflet/issues/4968#issuecomment-483402699\ndelete Icon.Default.prototype._getIconUrl;\nIcon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\n});\n\nconst center = [41.901493, 12.5009157];\n\nconst map = new Map('root', {\n  // Fix for a bug in Leaflet 1.7.1. See https://github.com/Leaflet/Leaflet/issues/7255\n  tap: false,\n  dragging: !Browser.mobile,\n}).setView(center, 13);\n\ntileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  attribution:\n    '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n})\n  .on('load', () => {\n    window.MAP_LOADED = true;\n  })\n  .addTo(map);\n\nconst popup = document.createElement('div');\npopup.innerHTML = `<div style=\"text-align: center; font-size: 120%\">B-Open</div>\n<img alt=\"B-Open logo\" width=\"75\" src=\"${icon}\" />\n`;\n\nmarker(center).addTo(map).bindPopup(popup);\n\nconst areaSelection = new DrawAreaSelection({\n  onPolygonReady: (polygon) => {\n    const preview = document.getElementById('polygon');\n    preview.textContent = JSON.stringify(polygon.toGeoJSON(3), undefined, 2);\n    preview.scrollTop = preview.scrollHeight;\n  },\n  onPolygonDblClick: (polygon, control, ev) => {\n    const geojson = geoJSON(polygon.toGeoJSON(), {\n      style: {\n        opacity: 0.5,\n        fillOpacity: 0.2,\n        color: 'red',\n      },\n    });\n    geojson.addTo(map);\n    control.deactivate();\n  },\n  onButtonActivate: () => {\n    const preview = document.getElementById('polygon');\n    preview.textContent = 'Please, draw your polygon';\n    console.log('Please, draw your polygon');\n  },\n  onButtonDeactivate: (polygon) => {\n    const preview = document.getElementById('polygon');\n    console.log('Deactivated');\n    preview.textContent = `Deactivated! Current polygon is:\n\n${polygon ? JSON.stringify(polygon.toGeoJSON(3), undefined, 2) : 'null'}`;\n  },\n  position: 'topleft',\n});\n\nmap.addControl(areaSelection);\n\nconst command = document.querySelector('#control');\ncommand.addEventListener('click', function () {\n  if (areaSelection.phase !== 'inactive') {\n    areaSelection.deactivate();\n  } else {\n    areaSelection.activate();\n  }\n});\n"],"sourceRoot":""}